<!DOCTYPE html>
<html lang="en">
<head>
    <title>User Dashboard - Helpdesk</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <style>
        body { background: linear-gradient(135deg, #f7971e, #ffd200); min-height: 100vh; }
        .navbar { background: #f7971e; }
        .card { box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37); }
        .fade-in { animation: fadeIn 1s; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(40px); } to { opacity: 1; transform: translateY(0); } }
        .logout-btn {
            position: absolute;
            right: 32px;
            top: 24px;
        }
    </style>
</head>
<body>
<nav class="navbar navbar-expand-lg navbar-dark position-relative">
    <div class="container-fluid">
        <a class="navbar-brand" href="home.html">Helpdesk</a>
        <div class="ms-auto">
            <span class="navbar-text">Welcome, User</span>
            <button class="btn btn-outline-info ms-2" id="profileBtn">ðŸ‘¤ Profile</button>
        </div>
    </div>
</nav>
<button class="btn btn-danger logout-btn" onclick="window.location.href='home.html'">Logout</button>
<div class="container mt-5 fade-in">
    <div class="row justify-content-center">
        <div class="col-md-8">
            <div class="card p-4 mb-4">
                <h3>Submit a New Ticket</h3>
                <form id="ticketForm">
                    <div class="mb-3">
                        <label class="form-label">Name</label>
                        <input type="text" class="form-control" name="name" required>
                    </div>
                    <div class="mb-3">
                        <label class="form-label">Issue</label>
                        <textarea class="form-control" name="issue" rows="3" required></textarea>
                    </div>
                    <button class="btn btn-warning w-100">Submit Ticket</button>
                </form>
            </div>
            <div class="card p-4">
                <h3>Your Tickets</h3>
                <ul id="userTickets" class="list-group"></ul>
            </div>
        </div>
    </div>
</div>
<script>
document.getElementById('ticketForm').onsubmit = function(e) {
    e.preventDefault();
    const data = Object.fromEntries(new FormData(e.target));
    let currentUser = JSON.parse(localStorage.getItem('current_user') || 'null');
    if (!currentUser || !currentUser.id) {
        window.location.href = 'home.html';
        return;
    }
    // Store ticket in localStorage with user ID
    let tickets = JSON.parse(localStorage.getItem('helpdesk_tickets') || '[]');
    const now = new Date();
    const dateTime = now.toLocaleString();
    tickets.push({ id: currentUser.id, name: data.name, issue: data.issue, status: 'OPEN', dateTime: dateTime });
    localStorage.setItem('helpdesk_tickets', JSON.stringify(tickets));
    // Add to list
    const li = document.createElement('li');
    li.className = 'list-group-item';
    li.innerHTML = `${data.name}: ${data.issue} <br><small>Submitted: ${dateTime}</small>`;
    document.getElementById('userTickets').appendChild(li);
    e.target.reset();
};
// Show only tickets for the logged-in user in user dashboard
function renderUserTickets() {
  var currentUser = JSON.parse(localStorage.getItem('current_user') || 'null');
  if (!currentUser || !currentUser.id) {
    window.location.href = 'home.html';
    return;
  }
  var tickets = JSON.parse(localStorage.getItem('helpdesk_tickets') || '[]');
  var userTickets = tickets.filter(t => t.id === currentUser.id);
  var list = document.getElementById('userTickets');
  list.innerHTML = '';
  userTickets.forEach((t, idx) => {
    var li = document.createElement('li');
    li.className = 'list-group-item d-flex justify-content-between align-items-center';
    li.innerHTML = `${t.issue} <span class="badge bg-${t.status === 'OPEN' ? 'warning' : 'success'}">${t.status}</span>`;
    list.appendChild(li);
  });
}
window.onload = function() {
  renderUserTickets();
};
document.getElementById('profileBtn').onclick = function() {
  let currentUser = JSON.parse(localStorage.getItem('current_user') || 'null');
  if (!currentUser) return;
  document.getElementById('profileModalBody').innerHTML = `
    <div><strong>Name:</strong> ${currentUser.name || ''}</div>
    <div><strong>ID:</strong> ${currentUser.id || ''}</div>
    <div><strong>Department:</strong> ${currentUser.department || ''}</div>
  `;
  let profileModal = new bootstrap.Modal(document.getElementById('profileModal'));
  profileModal.show();
};
</script>
<!-- Profile Modal -->
<div class="modal fade" id="profileModal" tabindex="-1" aria-labelledby="profileModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="profileModalLabel">User Profile</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body" id="profileModalBody">
        <!-- Profile content -->
      </div>
    </div>
  </div>
</div>
</body>
</html>
