<!DOCTYPE html>
<html lang="en">
<head>
    <title>Admin Dashboard - Helpdesk</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <style>
        body { background: linear-gradient(135deg, #2193b0, #6dd5ed); min-height: 100vh; }
        .navbar { background: #2193b0; }
        .card { box-shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37); }
        .fade-in { animation: fadeIn 1s; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(40px); } to { opacity: 1; transform: translateY(0); } }
        .sidebar {
            min-width: 140px;
            max-width: 140px;
            background: #e3f2fd;
            border-radius: 12px;
            padding: 24px 12px;
            height: 100%;
        }
        .sidebar .btn { width: 100%; margin-bottom: 12px; }
    </style>
</head>
<body>
<nav class="navbar navbar-expand-lg navbar-dark">
    <div class="container-fluid">
        <a class="navbar-brand" href="home.html">Helpdesk</a>
        <div class="ms-auto">
            <span class="navbar-text">Welcome, Admin</span>
            <button class="btn btn-outline-info ms-2" id="profileBtn">ðŸ‘¤ Profile</button>
            <button class="btn btn-danger ms-2" onclick="window.location.href='home.html'">Logout</button>
        </div>
    </div>
</nav>
<!-- Sidebar -->
<div class="d-flex">
  <div class="sidebar bg-light p-3 d-flex flex-column justify-content-between" style="min-width:140px; max-width:140px; height:100vh;">
    <div>
      <button class="btn btn-primary w-100 mb-2" id="showAddStaffBtn">Add Staff</button>
      <button class="btn btn-info w-100 mb-2" id="showStaffListBtn">Staff List</button>
      <button class="btn btn-warning w-100 mb-2" id="showNewTicketsBtn">New Ticket</button>
      <button class="btn btn-secondary w-100 mb-2" id="showPendingTicketsBtn">Pending Ticket</button>
      <button class="btn btn-success w-100 mb-2" id="showSolvedTicketsBtn">Solved Ticket</button>
      <button class="btn btn-info w-100 mb-2" id="showUserDetailsBtn">User Details</button>
    </div>
    <button class="btn btn-danger w-100 mt-2" id="logoutBtn">Logout</button>
  </div>
  <div class="flex-grow-1 p-4" id="mainContent">
    <!-- Main content area, initially empty -->
  </div>
</div>
<!-- Add this modal to the HTML body, ideally just before </body> -->
<div class="modal fade" id="solvedTicketModal" tabindex="-1" aria-labelledby="solvedTicketModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="solvedTicketModalLabel">Solved Ticket Details</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body" id="solvedTicketModalBody">
        <!-- Details will be injected here -->
      </div>
    </div>
  </div>
</div>
<script>
function renderSidebar() {
  return `<div class="sidebar bg-light p-3 d-flex flex-column justify-content-between" style="min-width:140px; max-width:140px; height:100vh;">
    <div>
      <button class="btn btn-primary w-100 mb-2" id="showAddStaffBtn">Add Staff</button>
      <button class="btn btn-info w-100 mb-2" id="showStaffListBtn">Staff List</button>
      <button class="btn btn-warning w-100 mb-2" id="showNewTicketsBtn">New Ticket</button>
      <button class="btn btn-secondary w-100 mb-2" id="showPendingTicketsBtn">Pending Ticket</button>
      <button class="btn btn-success w-100 mb-2" id="showSolvedTicketsBtn">Solved Ticket</button>
      <button class="btn btn-info w-100 mb-2" id="showUserDetailsBtn">User Details</button>
    </div>
    <button class="btn btn-danger w-100 mt-2" id="logoutBtn">Logout</button>
  </div>`;
}

function showAddStaff() {
  document.getElementById('mainContent').innerHTML = `
    <div class="card p-3 mb-4">
      <h5>Add Staff</h5>
      <form id="addStaffForm">
        <div class="mb-2">
          <label for="staffId" class="form-label">Staff ID</label>
          <input type="text" class="form-control" id="staffId" required>
        </div>
        <div class="mb-2">
          <label for="staffPassword" class="form-label">Password</label>
          <input type="password" class="form-control" id="staffPassword" required>
        </div>
        <div class="mb-2">
          <label for="staffName" class="form-label">Name</label>
          <input type="text" class="form-control" id="staffName" required>
        </div>
        <div class="mb-2">
          <label for="staffDept" class="form-label">Department</label>
          <input type="text" class="form-control" id="staffDept" required>
        </div>
        <button type="submit" class="btn btn-primary w-100">Add Staff</button>
      </form>
    </div>
  `;
  document.getElementById('addStaffForm').onsubmit = function(e) {
    e.preventDefault();
    var staffList = JSON.parse(localStorage.getItem('helpdesk_staff') || '[]');
    const staffId = document.getElementById('staffId').value;
    if (staffList.find(s => s.id === staffId)) {
      alert('Staff ID already exists!');
      return;
    }
    staffList.push({
      id: staffId,
      password: document.getElementById('staffPassword').value,
      staffName: document.getElementById('staffName').value,
      department: document.getElementById('staffDept').value,
      phone: '',
      mail: ''
    });
    localStorage.setItem('helpdesk_staff', JSON.stringify(staffList));
    alert('Staff added successfully!');
    // Optionally, refresh staff list or clear form
  };
}
function showStaffList() {
  var staffList = JSON.parse(localStorage.getItem('helpdesk_staff') || '[]');
  let html = `<div class='card p-3'><h5>Staff List</h5><ul class='list-group'>`;
  staffList.forEach((staff, idx) => {
    html += `<li class='list-group-item d-flex justify-content-between align-items-center'>
      <span>${staff.name} (${staff.id}) - ${staff.department}</span>
      <div>
        <button class='btn btn-sm btn-outline-primary me-2' onclick='editStaff(${idx})'>Edit</button>
        <button class='btn btn-sm btn-outline-danger' onclick='deleteStaff(${idx})'>Delete</button>
      </div>
    </li>`;
  });
  html += `</ul></div>`;
  document.getElementById('mainContent').innerHTML = html;
}
function showTickets(filter) {
  var tickets = JSON.parse(localStorage.getItem('helpdesk_tickets') || '[]');
  var filtered = tickets;
  if (filter === 'NEW') filtered = tickets.filter(t => t.status === 'OPEN');
  if (filter === 'PENDING') filtered = tickets.filter(t => t.status === 'OPEN');
  if (filter === 'SOLVED') filtered = tickets.filter(t => t.status === 'SOLVED');
  let html = `<div class='card p-3'><h5>${filter === 'NEW' ? 'New Tickets' : filter === 'PENDING' ? 'Pending Tickets' : 'Solved Tickets'}</h5><ul class='list-group'>`;
  filtered.forEach((t, idx) => {
    let ticketIdx = getTicketIndex(t);
    let solvedBadge = t.status === 'SOLVED' ? "<span class='badge bg-success ms-2'>Solved</span>" : '';
    html += `<li class='list-group-item d-flex justify-content-between align-items-center'>
      <span>${t.name} ${solvedBadge}</span>
      <div>
        <button class='btn btn-sm btn-outline-info me-2' onclick='showTicketDetailsModal(${ticketIdx})'>View</button>
        ${filter !== 'SOLVED' ? `<button class='btn btn-sm btn-success me-2' onclick='markTicketSolved(${ticketIdx})'>Mark as Solved</button>` : ''}
        <button class='btn btn-sm btn-danger' onclick='deleteTicket(${ticketIdx})'>Delete</button>
      </div>
    </li>`;
  });
  html += `</ul></div>`;
  document.getElementById('mainContent').innerHTML = html;
}
function showTicketDetailsModal(idx) {
  let tickets = JSON.parse(localStorage.getItem('helpdesk_tickets') || '[]');
  let t = tickets[idx];
  // Ensure modal exists in DOM
  let modal = document.getElementById('solvedTicketModal');
  if (!modal) {
    let modalHtml = `<div class="modal fade" id="solvedTicketModal" tabindex="-1" aria-labelledby="solvedTicketModalLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="solvedTicketModalLabel">Solved Ticket Details</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body" id="solvedTicketModalBody"></div>
        </div>
      </div>
    </div>`;
    document.body.insertAdjacentHTML('beforeend', modalHtml);
    modal = document.getElementById('solvedTicketModal');
  }
  document.getElementById('solvedTicketModalBody').innerHTML = `
    <div><strong>Name:</strong> ${t.name}</div>
    <div><strong>Issue:</strong> <div style='white-space:pre-line;'>${t.issue.replace(/\n/g, '<br>')}</div></div>
    <div><strong>Status:</strong> ${t.status}</div>
    <div><strong>Submitted Date & Time:</strong> ${t.dateTime || 'N/A'}</div>
    <div><strong>Approved Date & Time:</strong> ${t.approvedDate || 'N/A'}</div>
    <div><strong>Approved By:</strong> ${t.approvedBy || 'N/A'}</div>
  `;
  if (window.solvedTicketModalInstance) {
    window.solvedTicketModalInstance.hide();
  }
  window.solvedTicketModalInstance = new bootstrap.Modal(modal);
  window.solvedTicketModalInstance.show();
}
function showSolvedTicketsWithCalendar() {
  let tickets = JSON.parse(localStorage.getItem('helpdesk_tickets') || '[]');
  let solvedTickets = tickets.filter(t => t.status === 'SOLVED');
  let html = `<div class='card p-3'>
    <h5>Solved Tickets</h5>
    <div class='mb-3'>
      <label for='solvedDate' class='form-label'>Filter by Date</label>
      <input type='date' class='form-control' id='solvedDate'>
    </div>
    <ul id='solvedTicketList' class='list-group'>`;
  solvedTickets.forEach((t, idx) => {
    let ticketIdx = getTicketIndex(t);
    html += `<li class='list-group-item d-flex justify-content-between align-items-center'>
      <span>${t.name} <span class='badge bg-success ms-2'>Solved</span></span>
      <div>
        <button class='btn btn-sm btn-outline-info me-2' onclick='showTicketDetailsModal(${ticketIdx})'>View</button>
        <button class='btn btn-sm btn-warning me-2' onclick='unsolveTicket(${ticketIdx})'>Unsolve</button>
        <button class='btn btn-sm btn-danger' onclick='deleteTicket(${ticketIdx})'>Delete</button>
      </div>
    </li>`;
  });
  html += `</ul></div>`;
  document.getElementById('mainContent').innerHTML = html;
  document.getElementById('solvedDate').onchange = function() {
    let selectedDate = this.value;
    let filtered = solvedTickets.filter(t => {
      if (!t.dateTime) return false;
      let ticketDate = new Date(t.dateTime);
      let yyyy = ticketDate.getFullYear();
      let mm = String(ticketDate.getMonth() + 1).padStart(2, '0');
      let dd = String(ticketDate.getDate()).padStart(2, '0');
      let formatted = `${yyyy}-${mm}-${dd}`;
      return formatted === selectedDate;
    });
    let ul = document.getElementById('solvedTicketList');
    ul.innerHTML = '';
    filtered.forEach(t => {
      let idx = getTicketIndex(t);
      let li = document.createElement('li');
      li.className = 'list-group-item d-flex justify-content-between align-items-center';
      li.innerHTML = `<span>${t.name} <span class='badge bg-success ms-2'>Solved</span></span>
        <div>
          <button class='btn btn-sm btn-outline-info me-2' onclick='showTicketDetailsModal(${idx})'>View</button>
          <button class='btn btn-sm btn-warning me-2' onclick='unsolveTicket(${idx})'>Unsolve</button>
          <button class='btn btn-sm btn-danger' onclick='deleteTicket(${idx})'>Delete</button>
        </div>`;
      ul.appendChild(li);
    });
  };
}
window.markTicketSolved = function(idx) {
  var tickets = JSON.parse(localStorage.getItem('helpdesk_tickets') || '[]');
  tickets[idx].status = 'SOLVED';
  tickets[idx].approvedDate = new Date().toLocaleString();
  tickets[idx].approvedBy = 'Admin';
  localStorage.setItem('helpdesk_tickets', JSON.stringify(tickets));
  // Refresh current ticket view
  let main = document.getElementById('mainContent').querySelector('h5');
  if (main && main.textContent.includes('New')) showTickets('NEW');
  else if (main && main.textContent.includes('Pending')) showTickets('PENDING');
  else showTickets('SOLVED');
};
function getTicketIndex(ticket) {
  var tickets = JSON.parse(localStorage.getItem('helpdesk_tickets') || '[]');
  return tickets.findIndex(t => t.name === ticket.name && t.issue === ticket.issue && t.dateTime === ticket.dateTime);
}
window.deleteTicket = function(idx) {
  var tickets = JSON.parse(localStorage.getItem('helpdesk_tickets') || '[]');
  tickets.splice(idx, 1);
  localStorage.setItem('helpdesk_tickets', JSON.stringify(tickets));
  // Refresh ticket views
  let main = document.getElementById('mainContent').querySelector('h5');
  if (main && main.textContent.includes('New')) showTickets('NEW');
  else if (main && main.textContent.includes('Pending')) showTickets('PENDING');
  else if (main && main.textContent.includes('Solved')) showSolvedTicketsWithCalendar();
};
// Add editStaff and deleteStaff functions for staff list actions
window.editStaff = function(idx) {
  var staffList = JSON.parse(localStorage.getItem('helpdesk_staff') || '[]');
  var staff = staffList[idx];
  let html = `<div class='card p-4'>
    <h5>Edit Staff</h5>
    <form id='editStaffForm'>
      <div class='mb-2'>
        <label for='editStaffId' class='form-label'>Staff ID</label>
        <input type='text' class='form-control' id='editStaffId' value='${staff.id}' required>
      </div>
      <div class='mb-2'>
        <label for='editStaffPassword' class='form-label'>Password</label>
        <input type='text' class='form-control' id='editStaffPassword' value='${staff.password}' required>
      </div>
      <div class='mb-2'>
        <label for='editStaffName' class='form-label'>Name</label>
        <input type='text' class='form-control' id='editStaffName' value='${staff.staffName}' required>
      </div>
      <div class='mb-2'>
        <label for='editStaffDept' class='form-label'>Department</label>
        <input type='text' class='form-control' id='editStaffDept' value='${staff.department}' required>
      </div>
      <button type='submit' class='btn btn-primary mt-2'>Save</button>
    </form>
    <button class='btn btn-secondary mt-3' id='backToStaffListBtn'>Back</button>
  </div>`;
  document.getElementById('mainContent').innerHTML = html;
  document.getElementById('editStaffForm').onsubmit = function(e) {
    e.preventDefault();
    staffList[idx].id = document.getElementById('editStaffId').value;
    staffList[idx].password = document.getElementById('editStaffPassword').value;
    staffList[idx].staffName = document.getElementById('editStaffName').value;
    staffList[idx].department = document.getElementById('editStaffDept').value;
    localStorage.setItem('helpdesk_staff', JSON.stringify(staffList));
    alert('Staff updated successfully!');
    showStaffList();
  };
  document.getElementById('backToStaffListBtn').onclick = function() {
    showStaffList();
  };
};
window.deleteStaff = function(idx) {
  var staffList = JSON.parse(localStorage.getItem('helpdesk_staff') || '[]');
  if (confirm('Are you sure you want to delete this staff member?')) {
    staffList.splice(idx, 1);
    localStorage.setItem('helpdesk_staff', JSON.stringify(staffList));
    alert('Staff deleted successfully!');
    showStaffList();
  }
};
document.getElementById('showAddStaffBtn').onclick = showAddStaff;
document.getElementById('showStaffListBtn').onclick = showStaffList;
document.getElementById('showNewTicketsBtn').onclick = function() { showTickets('NEW'); };
document.getElementById('showPendingTicketsBtn').onclick = function() { showTickets('PENDING'); };
document.getElementById('showSolvedTicketsBtn').onclick = function() {
  showSolvedTicketsWithCalendar();
};
// Add 'User Details' button to admin dashboard sidebar
var sidebar = document.querySelector('.sidebar');
if (sidebar && !document.getElementById('showUserDetailsBtn')) {
  var userDetailsBtn = document.createElement('button');
  userDetailsBtn.className = 'btn btn-info w-100 mb-2';
  userDetailsBtn.id = 'showUserDetailsBtn';
  userDetailsBtn.textContent = 'User Details';
  sidebar.insertBefore(userDetailsBtn, sidebar.children[2]); // Insert after Staff List
  userDetailsBtn.onclick = showUserDetails;
}
// Add showUserDetails function to display user details table
function showUserDetails() {
  var userList = JSON.parse(localStorage.getItem('helpdesk_users') || '[]');
  var html = `<div class='card p-4'><h5>User Details</h5><table class='table'><thead><tr><th>ID</th><th>Name</th><th>Department</th></tr></thead><tbody>`;
  userList.forEach(user => {
    html += `<tr><td>${user.id}</td><td>${user.name || ''}</td><td>${user.department || ''}</td></tr>`;
  });
  html += `</tbody></table></div>`;
  document.getElementById('mainContent').innerHTML = html;
}
function showSolvedTicketsWithCalendar() {
  let tickets = JSON.parse(localStorage.getItem('helpdesk_tickets') || '[]');
  let solvedTickets = tickets.filter(t => t.status === 'SOLVED');
  let html = `<div class='card p-3'>
    <h5>Solved Tickets</h5>
    <div class='mb-3'>
      <label for='solvedDate' class='form-label'>Filter by Date</label>
      <input type='date' class='form-control' id='solvedDate'>
    </div>
    <ul id='solvedTicketList' class='list-group'>`;
  solvedTickets.forEach((t, idx) => {
    let ticketIdx = getTicketIndex(t);
    html += `<li class='list-group-item d-flex justify-content-between align-items-center'>
      <span>${t.name} <span class='badge bg-success ms-2'>Solved</span></span>
      <div>
        <button class='btn btn-sm btn-outline-info me-2' onclick='showTicketDetailsModal(${ticketIdx})'>View</button>
        <button class='btn btn-sm btn-warning me-2' onclick='unsolveTicket(${ticketIdx})'>Unsolve</button>
        <button class='btn btn-sm btn-danger' onclick='deleteTicket(${ticketIdx})'>Delete</button>
      </div>
    </li>`;
  });
  html += `</ul></div>`;
  document.getElementById('mainContent').innerHTML = html;
  document.getElementById('solvedDate').onchange = function() {
    let selectedDate = this.value;
    let filtered = solvedTickets.filter(t => {
      if (!t.dateTime) return false;
      let ticketDate = new Date(t.dateTime);
      let yyyy = ticketDate.getFullYear();
      let mm = String(ticketDate.getMonth() + 1).padStart(2, '0');
      let dd = String(ticketDate.getDate()).padStart(2, '0');
      let formatted = `${yyyy}-${mm}-${dd}`;
      return formatted === selectedDate;
    });
    let ul = document.getElementById('solvedTicketList');
    ul.innerHTML = '';
    filtered.forEach(t => {
      let idx = getTicketIndex(t);
      let li = document.createElement('li');
      li.className = 'list-group-item d-flex justify-content-between align-items-center';
      li.innerHTML = `<span>${t.name} <span class='badge bg-success ms-2'>Solved</span></span>
        <div>
          <button class='btn btn-sm btn-outline-info me-2' onclick='showTicketDetailsModal(${idx})'>View</button>
          <button class='btn btn-sm btn-warning me-2' onclick='unsolveTicket(${idx})'>Unsolve</button>
          <button class='btn btn-sm btn-danger' onclick='deleteTicket(${idx})'>Delete</button>
        </div>`;
      ul.appendChild(li);
    });
  };
}
window.unsolveTicket = function(idx) {
  var tickets = JSON.parse(localStorage.getItem('helpdesk_tickets') || '[]');
  tickets[idx].status = 'OPEN';
  tickets[idx].approvedDate = '';
  tickets[idx].approvedBy = '';
  localStorage.setItem('helpdesk_tickets', JSON.stringify(tickets));
  showSolvedTicketsWithCalendar();
};
function showSolvedTicketDetails(idx) {
  let tickets = JSON.parse(localStorage.getItem('helpdesk_tickets') || '[]');
  let t = tickets[idx];
  let commentsHtml = (t.comments || []).map((c, i) => `<li><strong>Comment ${i+1}:</strong> ${c}</li>`).join('');
  document.getElementById('solvedTicketModalBody').innerHTML = `
    <div><strong>Name:</strong> ${t.name}</div>
    <div><strong>Issue:</strong> ${t.issue}</div>
    <div><strong>Status:</strong> ${t.status}</div>
    <div><strong>Submitted Date:</strong> ${t.dateTime || 'N/A'}</div>
    <div><strong>Approved Date:</strong> ${t.approvedDate || 'N/A'}</div>
    <div><strong>Approved By:</strong> ${t.approvedBy || 'N/A'}</div>
    <div class='mb-2'><strong>Comments:</strong> <ul id='adminCommentList'>${commentsHtml || '<li>No comments yet.</li>'}</ul></div>
    <form id='adminCommentForm'>
      <div class='mb-2'>
        <input type='text' class='form-control' id='adminCommentInput' placeholder='Reply to this ticket'>
      </div>
      <button type='submit' class='btn btn-primary'>Reply</button>
    </form>
  `;
  document.getElementById('adminCommentForm').onsubmit = function(e) {
    e.preventDefault();
    let comment = document.getElementById('adminCommentInput').value;
    if (!comment) return;
    if (!tickets[idx].comments) tickets[idx].comments = [];
    tickets[idx].comments.push('Admin: ' + comment);
    localStorage.setItem('helpdesk_tickets', JSON.stringify(tickets));
    showSolvedTicketDetails(idx);
  };
  // Show the modal (ensure only one instance)
  if (window.solvedTicketModalInstance) {
    window.solvedTicketModalInstance.hide();
  }
  window.solvedTicketModalInstance = new bootstrap.Modal(document.getElementById('solvedTicketModal'));
  window.solvedTicketModalInstance.show();
}
window.viewTicket = function(idx) {
  let tickets = JSON.parse(localStorage.getItem('helpdesk_tickets') || '[]');
  let t = tickets[idx];
  document.getElementById('mainContent').innerHTML = `
    <div class='card p-4'>
      <h5>Ticket Details</h5>
      <div class='mb-2'><strong>Name:</strong> ${t.name}</div>
      <div class='mb-2'><strong>Issue:</strong> ${t.issue}</div>
      <div class='mb-2'><strong>Status:</strong> ${t.status}</div>
      <div class='mb-2'><strong>Submitted:</strong> ${t.dateTime || 'N/A'}</div>
      <button class='btn btn-secondary mt-3' onclick='showSolvedTicketsWithCalendar()'>Back to Solved Tickets</button>
    </div>
  `;
};
document.getElementById('logoutBtn').onclick = function() {
  localStorage.removeItem('current_admin');
  window.location.href = 'home.html';
};
document.getElementById('profileBtn').onclick = function() {
  let admin = JSON.parse(localStorage.getItem('current_admin') || '{}');
  document.getElementById('mainContent').innerHTML = `
    <div class='card p-3 mb-4'>
      <h5>Admin Profile</h5>
      <div class='mb-2'><strong>Name:</strong> <span id='profileName'>${admin.name || ''}</span></div>
      <div class='mb-2'><strong>ID:</strong> <span id='profileId'>${admin.id || ''}</span></div>
      <div class='mb-2'><strong>Phone:</strong> <span id='profilePhone'>${admin.phone || 'N/A'}</span></div>
      <div class='mb-2'><strong>Mail:</strong> <span id='profileMail'>${admin.mail || 'N/A'}</span></div>
      <button class='btn btn-outline-primary mt-3' id='editProfileBtn'>Edit</button>
      <button class='btn btn-outline-dark mt-2' id='changePasswordBtn'>Change Password</button>
    </div>
  `;
  document.getElementById('editProfileBtn').onclick = function() {
    document.getElementById('mainContent').innerHTML = `
      <div class='card p-3 mb-4'>
        <h5>Edit Admin Profile</h5>
        <form id='editProfileForm'>
          <div class='mb-2'>
            <label for='editName' class='form-label'>Name</label>
            <input type='text' class='form-control' id='editName' value='${admin.name || ''}' required>
          </div>
          <div class='mb-2'>
            <label for='editId' class='form-label'>ID</label>
            <input type='text' class='form-control' id='editId' value='${admin.id || ''}' required>
          </div>
          <div class='mb-2'>
            <label for='editPhone' class='form-label'>Phone</label>
            <input type='text' class='form-control' id='editPhone' value='${admin.phone || ''}'>
          </div>
          <div class='mb-2'>
            <label for='editMail' class='form-label'>Mail</label>
            <input type='email' class='form-control' id='editMail' value='${admin.mail || ''}'>
          </div>
          <button type='submit' class='btn btn-success w-100'>Save</button>
        </form>
      </div>
    `;
    document.getElementById('editProfileForm').onsubmit = function(e) {
      e.preventDefault();
      let adminList = JSON.parse(localStorage.getItem('helpdesk_admins') || '[]');
      let currentAdmin = JSON.parse(localStorage.getItem('current_admin') || '{}');
      let idx = adminList.findIndex(a => a.id === currentAdmin.id);
      let updatedAdmin = {
        ...adminList[idx],
        name: document.getElementById('editName').value,
        id: document.getElementById('editId').value,
        phone: document.getElementById('editPhone').value,
        mail: document.getElementById('editMail').value
      };
      adminList[idx] = updatedAdmin;
      localStorage.setItem('helpdesk_admins', JSON.stringify(adminList));
      localStorage.setItem('current_admin', JSON.stringify(updatedAdmin));
      alert('Profile updated successfully!');
      document.getElementById('profileBtn').click();
    };
  };
  document.getElementById('changePasswordBtn').onclick = function() {
    let admin = JSON.parse(localStorage.getItem('current_admin') || '{}');
    document.getElementById('mainContent').innerHTML = `
      <div class='card p-3 mb-4'>
        <h5>Change Password / Edit ID</h5>
        <form id='changePasswordForm'>
          <div class='mb-2'>
            <label for='editAdminId' class='form-label'>Admin ID</label>
            <input type='text' class='form-control' id='editAdminId' value='${admin.id || ''}' required>
          </div>
          <div class='mb-2'>
            <label for='oldPassword' class='form-label'>Old Password</label>
            <input type='password' class='form-control' id='oldPassword' required>
          </div>
          <div class='mb-2'>
            <label for='newPassword' class='form-label'>New Password</label>
            <input type='password' class='form-control' id='newPassword' required>
          </div>
          <button type='submit' class='btn btn-primary w-100'>Update</button>
        </form>
      </div>
    `;
    document.getElementById('changePasswordForm').onsubmit = function(e) {
      e.preventDefault();
      let adminList = JSON.parse(localStorage.getItem('helpdesk_admins') || '[]');
      let currentAdmin = JSON.parse(localStorage.getItem('current_admin') || '{}');
      let oldPass = document.getElementById('oldPassword').value;
      let newPass = document.getElementById('newPassword').value;
      let newId = document.getElementById('editAdminId').value;
      let admin = adminList.find(a => a.id === currentAdmin.id);
      if (admin && admin.password === oldPass) {
        admin.password = newPass;
        admin.id = newId;
        localStorage.setItem('helpdesk_admins', JSON.stringify(adminList));
        localStorage.setItem('current_admin', JSON.stringify(admin));
        alert('Admin ID and password updated successfully!');
        document.getElementById('profileBtn').click();
      } else {
        alert('Old password is incorrect!');
      }
    };
  };
};
document.getElementById('profileBtn').onclick();
</script>
</body>
</html>
